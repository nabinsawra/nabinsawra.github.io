<!DOCTYPE html>
<html>
<head>
  <title>Sawra Community Data</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>

  <form id="dataForm">
    <label>District:</label>
    <select id="district" required>
      <option value="">--Select District--</option>
      <option value="Sonitpur">Sonitpur</option>
      <option value="Dhemaji">Dhemaji</option>
    </select><br><br>

    <label>Village:</label>
    <select id="village" required>
      <option value="">--Select Village--</option>
      <option value="Namonigaon">Namonigaon</option>
      <option value="Rangapara">Rangapara</option>
    </select><br><br>

    <label>Name:</label>
    <input type="text" id="name" required><br><br>

    <label>Date of Birth:</label>
    <input type="date" id="dob"><br><br>

    <label>Population:</label>
    <input type="number" id="population"><br><br>

    <label>Qualification:</label>
    <input type="text" id="qualification"><br><br>

    <label>Occupation:</label>
    <select id="occupation" required>
      <option value="">--Select Occupation--</option>
      <option value="Employed">Employed</option>
      <option value="Unemployed">Unemployed</option>
      <option value="Student">Student</option>
    </select><br><br>

    <label>Father's Name:</label>
    <input type="text" id="fatherName"><br><br>

    <label>Mother's Name:</label>
    <input type="text" id="motherName"><br><br>

    <label>Address:</label>
    <textarea id="address"></textarea><br><br>

    <button type="submit">Submit</button>
  </form>

  <br>
  <button onclick="downloadExcel()">Download Excel</button>
  <br><br>
  <table border="1" id="dataTable">
    <thead>
      <tr>
        <th>District</th>
        <th>Village</th>
        <th>Name</th>
        <th>DOB</th>
        <th>Population</th>
        <th>Qualification</th>
        <th>Occupation</th>
        <th>Father's Name</th>
        <th>Mother's Name</th>
        <th>Address</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DB_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const form = document.getElementById("dataForm");
    const tableBody = document.querySelector("#dataTable tbody");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const district = document.getElementById("district").value;
      const village = document.getElementById("village").value;
      const name = document.getElementById("name").value;
      const dob = document.getElementById("dob").value;
      const population = document.getElementById("population").value;
      const qualification = document.getElementById("qualification").value;
      const occupation = document.getElementById("occupation").value;
      const fatherName = document.getElementById("fatherName").value;
      const motherName = document.getElementById("motherName").value;
      const address = document.getElementById("address").value;

      const data = {
        district,
        village,
        name,
        dob,
        population,
        qualification,
        occupation,
        fatherName,
        motherName,
        address,
        timestamp: Date.now()
      };

      const newRef = db.ref("entries").push();
      newRef.set(data).then(() => {
        alert("Data submitted!");
        form.reset();
        loadData();
      });
    });

    function loadData() {
      db.ref("entries").once("value", snapshot => {
        tableBody.innerHTML = "";
        snapshot.forEach(child => {
          const entry = child.val();
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${entry.district}</td>
            <td>${entry.village}</td>
            <td>${entry.name}</td>
            <td>${entry.dob}</td>
            <td>${entry.population}</td>
            <td>${entry.qualification}</td>
            <td>${entry.occupation || ''}</td>
            <td>${entry.fatherName}</td>
            <td>${entry.motherName}</td>
            <td>${entry.address}</td>
          `;
          tableBody.appendChild(row);
        });
      });
    }

    function downloadExcel() {
      db.ref("entries").once("value", snapshot => {
        const allEntries = [["District", "Village", "Name", "DOB", "Population", "Qualification", "Occupation", "Father's Name", "Mother's Name", "Address"]];
        snapshot.forEach(child => {
          const entry = child.val();
          allEntries.push([
            entry.district, entry.village, entry.name, entry.dob, entry.population,
            entry.qualification, entry.occupation || '', entry.fatherName, entry.motherName, entry.address
          ]);
        });

        const worksheet = XLSX.utils.aoa_to_sheet(allEntries);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Data");
        XLSX.writeFile(workbook, "CommunityData.xlsx");
      });
    }

    loadData();
  </script>
</body>
</html>
